var Ee=Object.defineProperty;var a=(e,t)=>Ee(e,"name",{value:t,configurable:!0});var ae=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var be=ae((T,ye)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});function _(e){return e&&typeof e=="object"&&"default"in e?e.default:e}a(_,"_interopDefault");var v=_(require("stream")),ue=_(require("http")),W=_(require("url")),$e=_(require("https")),j=_(require("zlib")),Be=v.Readable,O=Symbol("buffer"),Y=Symbol("type"),$=class{constructor(){this[Y]="";let t=arguments[0],r=arguments[1],o=[],n=0;if(t){let u=t,c=Number(u.length);for(let i=0;i<c;i++){let l=u[i],h;l instanceof Buffer?h=l:ArrayBuffer.isView(l)?h=Buffer.from(l.buffer,l.byteOffset,l.byteLength):l instanceof ArrayBuffer?h=Buffer.from(l):l instanceof $?h=l[O]:h=Buffer.from(typeof l=="string"?l:String(l)),n+=h.length,o.push(h)}}this[O]=Buffer.concat(o);let s=r&&r.type!==void 0&&String(r.type).toLowerCase();s&&!/[^\u0020-\u007E]/.test(s)&&(this[Y]=s)}get size(){return this[O].length}get type(){return this[Y]}text(){return Promise.resolve(this[O].toString())}arrayBuffer(){let t=this[O],r=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);return Promise.resolve(r)}stream(){let t=new Be;return t._read=function(){},t.push(this[O]),t.push(null),t}toString(){return"[object Blob]"}slice(){let t=this.size,r=arguments[0],o=arguments[1],n,s;r===void 0?n=0:r<0?n=Math.max(t+r,0):n=Math.min(r,t),o===void 0?s=t:o<0?s=Math.max(t+o,0):s=Math.min(o,t);let u=Math.max(s-n,0),i=this[O].slice(n,n+u),l=new $([],{type:arguments[2]});return l[O]=i,l}};a($,"Blob");Object.defineProperties($.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Object.defineProperty($.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0});function g(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}a(g,"FetchError");g.prototype=Object.create(Error.prototype);g.prototype.constructor=g;g.prototype.name="FetchError";var Z;try{Z=require("encoding").convert}catch(e){}var x=Symbol("Body internals"),le=v.PassThrough;function m(e){var t=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.size;let n=o===void 0?0:o;var s=r.timeout;let u=s===void 0?0:s;e==null?e=null:ce(e)?e=Buffer.from(e.toString()):H(e)||Buffer.isBuffer(e)||(Object.prototype.toString.call(e)==="[object ArrayBuffer]"?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof v||(e=Buffer.from(String(e)))),this[x]={body:e,disturbed:!1,error:null},this.size=n,this.timeout=u,e instanceof v&&e.on("error",function(c){let i=c.name==="AbortError"?c:new g(`Invalid response body while trying to fetch ${t.url}: ${c.message}`,"system",c);t[x].error=i})}a(m,"Body");m.prototype={get body(){return this[x].body},get bodyUsed(){return this[x].disturbed},arrayBuffer(){return k.call(this).then(function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)})},blob(){let e=this.headers&&this.headers.get("content-type")||"";return k.call(this).then(function(t){return Object.assign(new $([],{type:e.toLowerCase()}),{[O]:t})})},json(){var e=this;return k.call(this).then(function(t){try{return JSON.parse(t.toString())}catch(r){return m.Promise.reject(new g(`invalid json response body at ${e.url} reason: ${r.message}`,"invalid-json"))}})},text(){return k.call(this).then(function(e){return e.toString()})},buffer(){return k.call(this)},textConverted(){var e=this;return k.call(this).then(function(t){return Ce(t,e.headers)})}};Object.defineProperties(m.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}});m.mixIn=function(e){for(let t of Object.getOwnPropertyNames(m.prototype))if(!(t in e)){let r=Object.getOwnPropertyDescriptor(m.prototype,t);Object.defineProperty(e,t,r)}};function k(){var e=this;if(this[x].disturbed)return m.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[x].disturbed=!0,this[x].error)return m.Promise.reject(this[x].error);let t=this.body;if(t===null)return m.Promise.resolve(Buffer.alloc(0));if(H(t)&&(t=t.stream()),Buffer.isBuffer(t))return m.Promise.resolve(t);if(!(t instanceof v))return m.Promise.resolve(Buffer.alloc(0));let r=[],o=0,n=!1;return new m.Promise(function(s,u){let c;e.timeout&&(c=setTimeout(function(){n=!0,u(new g(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))},e.timeout)),t.on("error",function(i){i.name==="AbortError"?(n=!0,u(i)):u(new g(`Invalid response body while trying to fetch ${e.url}: ${i.message}`,"system",i))}),t.on("data",function(i){if(!(n||i===null)){if(e.size&&o+i.length>e.size){n=!0,u(new g(`content size at ${e.url} over limit: ${e.size}`,"max-size"));return}o+=i.length,r.push(i)}}),t.on("end",function(){if(!n){clearTimeout(c);try{s(Buffer.concat(r,o))}catch(i){u(new g(`Could not create Buffer from response body for ${e.url}: ${i.message}`,"system",i))}}})})}a(k,"consumeBody");function Ce(e,t){if(typeof Z!="function")throw new Error("The package `encoding` must be installed to use the textConverted() function");let r=t.get("content-type"),o="utf-8",n,s;return r&&(n=/charset=([^;]*)/i.exec(r)),s=e.slice(0,1024).toString(),!n&&s&&(n=/<meta.+?charset=(['"])(.+?)\1/i.exec(s)),!n&&s&&(n=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(s),n||(n=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(s),n&&n.pop()),n&&(n=/charset=(.*)/i.exec(n.pop()))),!n&&s&&(n=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(s)),n&&(o=n.pop(),(o==="gb2312"||o==="gbk")&&(o="gb18030")),Z(e,"UTF-8",o).toString()}a(Ce,"convertBody");function ce(e){return typeof e!="object"||typeof e.append!="function"||typeof e.delete!="function"||typeof e.get!="function"||typeof e.getAll!="function"||typeof e.has!="function"||typeof e.set!="function"?!1:e.constructor.name==="URLSearchParams"||Object.prototype.toString.call(e)==="[object URLSearchParams]"||typeof e.sort=="function"}a(ce,"isURLSearchParams");function H(e){return typeof e=="object"&&typeof e.arrayBuffer=="function"&&typeof e.type=="string"&&typeof e.stream=="function"&&typeof e.constructor=="function"&&typeof e.constructor.name=="string"&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}a(H,"isBlob");function fe(e){let t,r,o=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof v&&typeof o.getBoundary!="function"&&(t=new le,r=new le,o.pipe(t),o.pipe(r),e[x].body=t,o=r),o}a(fe,"clone");function de(e){return e===null?null:typeof e=="string"?"text/plain;charset=UTF-8":ce(e)?"application/x-www-form-urlencoded;charset=UTF-8":H(e)?e.type||null:Buffer.isBuffer(e)||Object.prototype.toString.call(e)==="[object ArrayBuffer]"||ArrayBuffer.isView(e)?null:typeof e.getBoundary=="function"?`multipart/form-data;boundary=${e.getBoundary()}`:e instanceof v?null:"text/plain;charset=UTF-8"}a(de,"extractContentType");function he(e){let t=e.body;return t===null?0:H(t)?t.size:Buffer.isBuffer(t)?t.length:t&&typeof t.getLengthSync=="function"&&(t._lengthRetrievers&&t._lengthRetrievers.length==0||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}a(he,"getTotalBytes");function Ae(e,t){let r=t.body;r===null?e.end():H(r)?r.stream().pipe(e):Buffer.isBuffer(r)?(e.write(r),e.end()):r.pipe(e)}a(Ae,"writeToStream");m.Promise=global.Promise;var pe=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,Q=/[^\t\x20-\x7e\x80-\xff]/;function I(e){if(e=`${e}`,pe.test(e)||e==="")throw new TypeError(`${e} is not a legal HTTP header name`)}a(I,"validateName");function me(e){if(e=`${e}`,Q.test(e))throw new TypeError(`${e} is not a legal HTTP header value`)}a(me,"validateValue");function U(e,t){t=t.toLowerCase();for(let r in e)if(r.toLowerCase()===t)return r}a(U,"find");var f=Symbol("map"),y=class{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;if(this[f]=Object.create(null),t instanceof y){let r=t.raw(),o=Object.keys(r);for(let n of o)for(let s of r[n])this.append(n,s);return}if(t!=null)if(typeof t=="object"){let r=t[Symbol.iterator];if(r!=null){if(typeof r!="function")throw new TypeError("Header pairs must be iterable");let o=[];for(let n of t){if(typeof n!="object"||typeof n[Symbol.iterator]!="function")throw new TypeError("Each header pair must be iterable");o.push(Array.from(n))}for(let n of o){if(n.length!==2)throw new TypeError("Each header pair must be a name/value tuple");this.append(n[0],n[1])}}else for(let o of Object.keys(t)){let n=t[o];this.append(o,n)}}else throw new TypeError("Provided initializer must be an object")}get(t){t=`${t}`,I(t);let r=U(this[f],t);return r===void 0?null:this[f][r].join(", ")}forEach(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,o=X(this),n=0;for(;n<o.length;){var s=o[n];let u=s[0],c=s[1];t.call(r,c,u,this),o=X(this),n++}}set(t,r){t=`${t}`,r=`${r}`,I(t),me(r);let o=U(this[f],t);this[f][o!==void 0?o:t]=[r]}append(t,r){t=`${t}`,r=`${r}`,I(t),me(r);let o=U(this[f],t);o!==void 0?this[f][o].push(r):this[f][t]=[r]}has(t){return t=`${t}`,I(t),U(this[f],t)!==void 0}delete(t){t=`${t}`,I(t);let r=U(this[f],t);r!==void 0&&delete this[f][r]}raw(){return this[f]}keys(){return te(this,"key")}values(){return te(this,"value")}[Symbol.iterator](){return te(this,"key+value")}};a(y,"Headers");y.prototype.entries=y.prototype[Symbol.iterator];Object.defineProperty(y.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0});Object.defineProperties(y.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});function X(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"key+value";return Object.keys(e[f]).sort().map(t==="key"?function(o){return o.toLowerCase()}:t==="value"?function(o){return e[f][o].join(", ")}:function(o){return[o.toLowerCase(),e[f][o].join(", ")]})}a(X,"getHeaders");var ee=Symbol("internal");function te(e,t){let r=Object.create(re);return r[ee]={target:e,kind:t,index:0},r}a(te,"createHeadersIterator");var re=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==re)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[ee];let t=e.target,r=e.kind,o=e.index,n=X(t,r),s=n.length;return o>=s?{value:void 0,done:!0}:(this[ee].index=o+1,{value:n[o],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(re,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});function ze(e){let t=Object.assign({__proto__:null},e[f]),r=U(e[f],"Host");return r!==void 0&&(t[r]=t[r][0]),t}a(ze,"exportNodeCompatibleHeaders");function Le(e){let t=new y;for(let r of Object.keys(e))if(!pe.test(r))if(Array.isArray(e[r]))for(let o of e[r])Q.test(o)||(t[f][r]===void 0?t[f][r]=[o]:t[f][r].push(o));else Q.test(e[r])||(t[f][r]=[e[r]]);return t}a(Le,"createHeadersLenient");var B=Symbol("Response internals"),je=ue.STATUS_CODES,w=class{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};m.call(this,t,r);let o=r.status||200,n=new y(r.headers);if(t!=null&&!n.has("Content-Type")){let s=de(t);s&&n.append("Content-Type",s)}this[B]={url:r.url,status:o,statusText:r.statusText||je[o],headers:n,counter:r.counter}}get url(){return this[B].url||""}get status(){return this[B].status}get ok(){return this[B].status>=200&&this[B].status<300}get redirected(){return this[B].counter>0}get statusText(){return this[B].statusText}get headers(){return this[B].headers}clone(){return new w(fe(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}};a(w,"Response");m.mixIn(w.prototype);Object.defineProperties(w.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});Object.defineProperty(w.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});var P=Symbol("Request internals"),ne=W.parse,Re=W.format,qe="destroy"in v.Readable.prototype;function D(e){return typeof e=="object"&&typeof e[P]=="object"}a(D,"isRequest");function ke(e){let t=e&&typeof e=="object"&&Object.getPrototypeOf(e);return!!(t&&t.constructor.name==="AbortSignal")}a(ke,"isAbortSignal");var S=class{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o;D(t)?o=ne(t.url):(t&&t.href?o=ne(t.href):o=ne(`${t}`),t={});let n=r.method||t.method||"GET";if(n=n.toUpperCase(),(r.body!=null||D(t)&&t.body!==null)&&(n==="GET"||n==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let s=r.body!=null?r.body:D(t)&&t.body!==null?fe(t):null;m.call(this,s,{timeout:r.timeout||t.timeout||0,size:r.size||t.size||0});let u=new y(r.headers||t.headers||{});if(s!=null&&!u.has("Content-Type")){let i=de(s);i&&u.append("Content-Type",i)}let c=D(t)?t.signal:null;if("signal"in r&&(c=r.signal),c!=null&&!ke(c))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[P]={method:n,redirect:r.redirect||t.redirect||"follow",headers:u,parsedURL:o,signal:c},this.follow=r.follow!==void 0?r.follow:t.follow!==void 0?t.follow:20,this.compress=r.compress!==void 0?r.compress:t.compress!==void 0?t.compress:!0,this.counter=r.counter||t.counter||0,this.agent=r.agent||t.agent}get method(){return this[P].method}get url(){return Re(this[P].parsedURL)}get headers(){return this[P].headers}get redirect(){return this[P].redirect}get signal(){return this[P].signal}clone(){return new S(this)}};a(S,"Request");m.mixIn(S.prototype);Object.defineProperty(S.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0});Object.defineProperties(S.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}});function Ue(e){let t=e[P].parsedURL,r=new y(e[P].headers);if(r.has("Accept")||r.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof v.Readable&&!qe)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let o=null;if(e.body==null&&/^(POST|PUT)$/i.test(e.method)&&(o="0"),e.body!=null){let s=he(e);typeof s=="number"&&(o=String(s))}o&&r.set("Content-Length",o),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let n=e.agent;return typeof n=="function"&&(n=n(t)),!r.has("Connection")&&!n&&r.set("Connection","close"),Object.assign({},t,{method:e.method,headers:ze(r),agent:n})}a(Ue,"getNodeRequestOptions");function F(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}a(F,"AbortError");F.prototype=Object.create(Error.prototype);F.prototype.constructor=F;F.prototype.name="AbortError";var ge=v.PassThrough,Ne=W.resolve;function C(e,t){if(!C.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return m.Promise=C.Promise,new C.Promise(function(r,o){let n=new S(e,t),s=Ue(n),u=(s.protocol==="https:"?$e:ue).request,c=n.signal,i=null,l=a(function(){let E=new F("The user aborted a request.");o(E),n.body&&n.body instanceof v.Readable&&n.body.destroy(E),!(!i||!i.body)&&i.body.emit("error",E)},"abort");if(c&&c.aborted){l();return}let h=a(function(){l(),L()},"abortAndFinalize"),z=u(s),G;c&&c.addEventListener("abort",h);function L(){z.abort(),c&&c.removeEventListener("abort",h),clearTimeout(G)}a(L,"finalize"),n.timeout&&z.once("socket",function(p){G=setTimeout(function(){o(new g(`network timeout at: ${n.url}`,"request-timeout")),L()},n.timeout)}),z.on("error",function(p){o(new g(`request to ${n.url} failed, reason: ${p.message}`,"system",p)),L()}),z.on("response",function(p){clearTimeout(G);let E=Le(p.headers);if(C.isRedirect(p.statusCode)){let K=E.get("Location"),q=K===null?null:Ne(n.url,K);switch(n.redirect){case"error":o(new g(`uri requested responds with a redirect, redirect mode is set to error: ${n.url}`,"no-redirect")),L();return;case"manual":if(q!==null)try{E.set("Location",q)}catch(Pe){o(Pe)}break;case"follow":if(q===null)break;if(n.counter>=n.follow){o(new g(`maximum redirect reached at: ${n.url}`,"max-redirect")),L();return}let M={headers:new y(n.headers),follow:n.follow,counter:n.counter+1,agent:n.agent,compress:n.compress,method:n.method,body:n.body,signal:n.signal,timeout:n.timeout,size:n.size};if(p.statusCode!==303&&n.body&&he(n)===null){o(new g("Cannot follow redirect with body being a readable stream","unsupported-redirect")),L();return}(p.statusCode===303||(p.statusCode===301||p.statusCode===302)&&n.method==="POST")&&(M.method="GET",M.body=void 0,M.headers.delete("content-length")),r(C(new S(q,M))),L();return}}p.once("end",function(){c&&c.removeEventListener("abort",h)});let b=p.pipe(new ge),N={url:n.url,status:p.statusCode,statusText:p.statusMessage,headers:E,size:n.size,timeout:n.timeout,counter:n.counter},R=E.get("Content-Encoding");if(!n.compress||n.method==="HEAD"||R===null||p.statusCode===204||p.statusCode===304){i=new w(b,N),r(i);return}let xe={flush:j.Z_SYNC_FLUSH,finishFlush:j.Z_SYNC_FLUSH};if(R=="gzip"||R=="x-gzip"){b=b.pipe(j.createGunzip(xe)),i=new w(b,N),r(i);return}if(R=="deflate"||R=="x-deflate"){p.pipe(new ge).once("data",function(q){(q[0]&15)==8?b=b.pipe(j.createInflate()):b=b.pipe(j.createInflateRaw()),i=new w(b,N),r(i)});return}if(R=="br"&&typeof j.createBrotliDecompress=="function"){b=b.pipe(j.createBrotliDecompress()),i=new w(b,N),r(i);return}i=new w(b,N),r(i)}),Ae(z,n)})}a(C,"fetch");C.isRedirect=function(e){return e===301||e===302||e===303||e===307||e===308};C.Promise=global.Promise;ye.exports=T=C;Object.defineProperty(T,"__esModule",{value:!0});T.default=T;T.Headers=y;T.Request=S;T.Response=w;T.FetchError=g});var Se=ae((Ze,ve)=>{"use strict";var oe=require("util"),_e=require("stream"),He=require("fs"),Ie=require("os"),Fe=require("path"),Me=require("child_process"),De=be(),Je=oe.promisify(Me.spawn),Ve=oe.promisify(_e.pipeline),J=a(e=>{if(e.includes(`
`))throw new Error("invalid write()");return new Promise(t=>process.stdout.write(e+`
`,t))},"write");console.log=(...e)=>{let t=e.map(o=>oe.format(o)).join(" "),r=encodeURIComponent(t);J(`ipc://stdout?value=${r}`)};console.error=console.log;var d={nextSeq:0};d.resolve=async(e,t,r)=>{let o=Number(t)?"reject":"resolve";if(!(!d[e]||!d[e][o]))try{await d[e][o](r)}finally{delete d[e]}};d.request=async(e,t)=>{let r=d.nextSeq++,o="",n=new Promise((s,u)=>{d[r]={resolve:s,reject:u}});try{typeof t.value=="object"&&(t.value=JSON.stringify(t.value)),o=new URLSearchParams({...t,index:t.window||"0",seq:r,value:t.value||"0"}).toString(),o=o.replace(/\+/g,"%20")}catch(s){return console.error(`Cannot encode request ${s.message} (${o})`),Promise.reject(s)}return await J(`ipc://${e}?${o}`),n};d.send=async e=>{if(e=JSON.parse(JSON.stringify(e)),typeof e.value=="object"&&(e.value=JSON.stringify(e.value)),!e.value||!e.value.trim())return;let t=new URLSearchParams({event:e.event,index:e.window,value:e.value}).toString();t=t.replace(/\+/g,"%20"),await J(`ipc://send?${t}`)};process.stdin.resume();process.stdin.setEncoding("utf8");var se="";async function Ge(e){let t=e.split(`
`);if(t.length===1){se+=e;return}let r=se+t[0];we(r);for(let o=1;o<t.length-1;o++)we(t[o]);se=t[t.length-1]}a(Ge,"handleMessage");async function we(e){let t="",r=0,o=0,n=0,s="";try{let l=new URL(e),h=Object.fromEntries(l.searchParams);t=l.host,o=h.seq,r=h.index,n=h.state||0,h.value&&(s=JSON.parse(h.value))}catch(l){let h=e.slice(0,100),z=e.slice(e.length-100);throw console.error(`Unable to parse stdin message ${l.code} ${l.message.slice(0,100)} (${h}...${z})`),new Error(`Unable to parse stdin message ${l.code} ${l.message.slice(0,20)}`)}if(t==="resolve")return d.resolve(o,n,s);let u,c="";try{u=await V.receive(t,s)}catch(l){u={err:{message:l.message}},n=1}u===void 0&&(u=null);try{c=JSON.stringify(u)}catch(l){n=1,c=JSON.stringify({err:{message:l.message}})}let i=new URLSearchParams({seq:o,state:n,index:r,value:c}).toString();i=i.replace(/\+/g,"%20"),await J(`ipc://resolve?${i}`)}a(we,"parse");process.stdin.on("data",Ge);var V={show(e){return d.request("show",e)},hide(e){return d.request("hide",e)},navigate(e){return d.request("navigate",e)},setTitle(e){return d.request("title",e)},setSize(e){return d.request("size",e)},getScreenSize(){return d.request("getScreenSize",{value:{}})},exit(e){return d.request("exit",e)},setMenu(e){return d.request("menu",e)},openExternal(e){return d.request("external",e)},send(e){return d.send(e)},restart(){return d.request("restart",{})},receive(e){return console.error("Receive Not Implemented",e),{err:new Error("Not Implemented!")}}};ve.exports=V;console.log("starting opkit-node",process.argv);process.argv.includes("--webviewFailed")&&Ke();async function Ke(){console.log("installWebView() fetch()");let e=await De("https://go.microsoft.com/fwlink/p/?LinkId=2124703");if(console.log("fetch status",e.status),e.status!==200)return console.log("attempt to alert()"),V.alert({value:"Could not connect to go.microsoft.com to download required native resources"});let t=Ie.tmpdir(),r=Fe.join(t,"webview-installer.exe");console.log("write res.body to tmp",r),await Ve(e.body,He.createWriteStream(r)),console.log("spawn tmp exe",r),await Je(r,[],{stdio:"inherit"}),console.log("spawn yields"),V.restart()}a(Ke,"installWebView")});var Te=require("path"),Oe=require("assert"),A=Se(),ie=0;async function We(){await A.show({window:0});let e=Te.dirname(process.argv[1]),t=Te.join(e,"index.html");await A.navigate({window:0,value:`file://${t}`});let r=await A.getScreenSize();Oe(r.width,"screen has width"),Oe(r.height,"screen has width"),await A.setTitle({window:0,value:"Hello"});let o=`
    Operator:
      About Operator: _
      ---
      Preferences...: , + Meta
      ---
      Hide: h + Meta
      Hide Others: h + Control + Meta
      ---
      Quit: q + CommandOrControl
    ;

    Edit:
      Cut: x + CommandOrControl
      Copy: c + CommandOrControl
      Paste: v + CommandOrControl
      Delete: _
      Select All: a + CommandOrControl
    ;

    Foo:
      Bazz: z + Meta
      ---
      Quxx: e + Meta + Alt
    ;

    Other:
      Another Test: t + Alt
      Beep: T + Meta
    ;
  `;await A.setMenu({window:0,value:o}),A.receive=async(s,u)=>(console.log("xxx ->",s,u),u&&u.restart&&await A.restart(),{received:u,command:s,counter:ie++});let n=100;setInterval(()=>{ie++;let s=14,u=new Array(s).fill(0);n--<=0||A.send({window:0,event:"data",value:{sending:u.join(""),counter:ie,size:s}})},16*100)}a(We,"main");We();
